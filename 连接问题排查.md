# 🔧 连接问题排查指南

## ✅ 服务状态正常

根据诊断结果，服务运行完全正常：
- ✅ 服务进程正在运行（PID: 439）
- ✅ 端口 8000 正在监听
- ✅ 本地连接测试通过
- ✅ 无错误日志

## 🌐 可用访问地址

### 本机访问
```
http://localhost:8000/
http://127.0.0.1:8000/
```

### 局域网访问
```
http://9.129.208.232:8000/
http://9.129.208.232:8000/app.html
```

## 💡 解决方案

### 方案1：更换浏览器地址（推荐）

如果 `http://localhost:8000/` 无法访问，尝试使用：

```
http://127.0.0.1:8000/
```

**为什么？**
- `localhost` 有时会被浏览器或代理重定向
- `127.0.0.1` 是直接IP地址，更可靠

### 方案2：清除浏览器缓存

1. 打开浏览器设置
2. 找到"清除浏览数据"
3. 选择清除缓存
4. 重新访问 `http://localhost:8000/`

### 方案3：使用无痕模式

- **Chrome**: Ctrl+Shift+N
- **Firefox**: Ctrl+Shift+P
- **Edge**: Ctrl+Shift+N

在无痕窗口中打开 `http://localhost:8000/`

### 方案4：尝试不同端口

如果8000端口有问题，可以换用其他端口：

1. **修改配置**
   编辑 `src/server.py` 的最后一行：
   ```python
   uvicorn.run(app, host="0.0.0.0", port=8080)  # 改为8080
   ```

2. **重启服务**
   ```bash
   pkill -f 'python src/server.py'
   python src/server.py
   ```

3. **访问新地址**
   ```
   http://localhost:8080/
   ```

### 方案5：检查代理设置

1. **Chrome浏览器**
   - 设置 > 系统 > 打开代理设置
   - 检查是否启用了代理
   - 暂时禁用代理

2. **系统代理**
   - 检查系统网络设置
   - 确保没有启用代理

### 方案6：使用容器IP访问

如果是在容器环境，尝试使用容器IP：

```
http://9.129.208.232:8000/
http://9.129.208.232:8000/app.html
```

### 方案7：使用curl测试

在终端中测试服务是否真的在运行：

```bash
curl http://localhost:8000/
curl http://127.0.0.1:8000/
curl http://9.129.208.232:8000/
```

如果curl能访问但浏览器不能，说明是浏览器问题。

## 🔍 常见错误信息

### "localhost 拒绝了我们的连接请求"

**可能原因：**
1. 端口被防火墙阻止
2. 浏览器代理设置问题
3. DNS解析问题

**解决方法：**
```
使用 http://127.0.0.1:8000/ 代替 http://localhost:8000/
```

### "此站点无法访问"

**可能原因：**
1. 服务未启动
2. 端口被占用
3. 防火墙阻止

**解决方法：**
```bash
# 1. 检查服务
ps aux | grep python

# 2. 检查端口
lsof -i :8000

# 3. 重启服务
pkill -f python
python src/server.py
```

### "连接超时"

**可能原因：**
1. 网络问题
2. 防火墙阻止
3. 服务响应慢

**解决方法：**
1. 检查网络连接
2. 暂时关闭防火墙测试
3. 等待服务完全启动

## 🧪 测试步骤

### 步骤1：确认服务运行

```bash
# 运行健康检查
./scripts/health-check.sh

# 或运行诊断
./scripts/fix-connection.sh
```

### 步骤2：测试多个地址

依次尝试以下地址，看哪个能用：

1. http://localhost:8000/
2. http://127.0.0.1:8000/
3. http://9.129.208.232:8000/
4. http://9.129.208.232:8000/app.html

### 步骤3：使用curl测试

```bash
curl -v http://localhost:8000/
```

查看详细的连接信息。

### 步骤4：查看日志

```bash
# 实时查看日志
tail -f /tmp/app_server.log

# 查看最近的错误
grep -i error /tmp/app_server.log | tail -10
```

## 📞 如果以上都不行

### 提供以下信息以便进一步排查：

1. **使用的操作系统**（Windows/Mac/Linux）
2. **使用的浏览器**（Chrome/Firefox/Edge/Safari）
3. **完整的错误信息**
4. **curl测试结果**：
   ```bash
   curl -v http://localhost:8000/ 2>&1
   ```
5. **健康检查结果**：
   ```bash
   ./scripts/health-check.sh
   ```

## 🚀 快速重启服务

如果需要重启服务，执行：

```bash
# 停止服务
pkill -f 'python src/server.py'

# 启动服务
./scripts/start.sh
```

或者：

```bash
# 一键重启
pkill -f 'python src/server.py' && sleep 2 && python src/server.py > /tmp/app_server.log 2>&1 &
```

## ✅ 验证成功标志

如果看到以下内容，说明访问成功了：

### 桌面版
- 页面标题：AI社交模拟卡牌游戏
- 显示卡牌列表或"还没有卡牌人物"
- 有"新增卡牌人物"按钮

### 移动版
- 页面标题：社交模拟卡牌
- 显示游戏化深色界面
- 有"✨ 新增卡牌人物"按钮
- 有底部导航栏

---

**尝试以上方案，如果有问题请告诉我具体错误信息！** 🔧
